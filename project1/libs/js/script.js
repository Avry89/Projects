$(document).ready(function(){$(".preloader").fadeOut("slow"),$("select").removeAttr("hidden")});const osmProvider='<a href="http://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>',thunderForestProvider='<a href="http://www.thunderforest.com">Thunderforest</a>',mapAttribution='Maps &copy; <a href="http://www.thunderforest.com">Thunderforest</a>, Data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>',mapTileLayers=["cycle","transport","landscape","outdoors"],mapBaseLayers={};mapTileLayers.map(a=>{let e="https://tile.thunderforest.com/"+a+"/{z}/{x}/{y}.png?apikey=b844895a39854b46af66bfecd8fd258a";mapBaseLayers[a]=L.tileLayer(e,{attribution:'Maps &copy; <a href="http://www.thunderforest.com">Thunderforest</a>, Data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap contributors</a>'})});const myMap=L.map("map",{maxZoom:18,minZoom:3,zoomControl:!1,layers:mapBaseLayers.cycle}).setView([51,-1],5);let layerControl=L.control.layers(mapBaseLayers,null,{position:"topleft"});layerControl.addTo(myMap),L.control.zoom({position:"topright"}).addTo(myMap),L.control.scale().addTo(myMap);let btn1=L.easyButton("fa-info-circle",function(a,e){$("#countryModal").modal("show")}).addTo(myMap),btn2=L.easyButton("fa fa-usd",function(a,e){$("#currencyModal").modal("show"),currencyExchange()}).addTo(myMap),btn3=L.easyButton("fa-cloud",function(a,e){$("#weatherModal").modal("show"),weatherForecast()}).addTo(myMap),btn4=L.easyButton("fas fa-gifts",function(a,e){$("#holidayModal").modal("show"),publicHolidays()}).addTo(myMap);function showLocation(a,e,t){let o=a.coords.latitude,r=a.coords.longitude;$.ajax({url:"libs/php/getUserLocation.php",type:"POST",dataType:"json",data:{latOne:o,lngOne:r},success:function(a){"ok"==a.status.name&&($("#selectCountry").val(a.data.countryCode),displayCountryMap(a.data.countryCode),displayEarthquakeMarkers(a.data.countryCode),displayPlaceOfInterestMarkers(a.data.countryCode),e())},error:function(a,e,t){console.log("ERROR")}})}function displayCountryMap(a){$.ajax({url:"libs/php/getCountryBorders.php",type:"GET",dataType:"json",data:{iso:a},success:function(a){void 0!=countryBorder&&myMap.removeLayer(countryBorder),countryBorder=L.geoJSON(a.data.geometry,{style:()=>({color:"Green",weight:2,opacity:2})}).addTo(myMap),myMap.fitBounds(countryBorder.getBounds())},error:function(a){console.log(a)}})}$.ajax({url:"libs/php/populateSelect.php",type:"POST",dataType:"json",success:function(a){a.data.forEach(a=>{$("<option>",{value:a.iso_a2,text:a.name}).appendTo("#selectCountry")})}}),window.navigator.geolocation?window.navigator.geolocation.getCurrentPosition(a=>{showLocation(a,()=>{populateModal()})}):console.log("Please turn on Location Services");let countryBorder;function populateModal(){let a=$("#selectCountry").val();$.ajax({url:"libs/php/getCountryInfo.php",type:"GET",dataType:"json",data:{countryCode:a},success:function(a){$("#continent").text(a.data[0].continent),$("#country").text(a.data[0].countryName),$("#capital").text(a.data[0].capital),$("#population").text(a.data[0].population),$("#area").text(a.data[0].areaInSqKm),$("#currency").text(a.data[0].currencyCode)},error:function(a){console.log(a)}})}function currencyExchange(){let a=$("#selectCountry").val();$.ajax({url:"libs/php/getCurrencyExchange.php",type:"GET",dataType:"json",data:{countryCode:a},success:function(a){var e=a.data.base_currency_code,t=a.data.base_currency_name,o=Object.keys(a.data.rates)[0],r=a.data.rates[o].currency_name,n=a.data.rates[o].rate;$("#baseCurrencyCode").text("Base Currency Code: "+e),$("#baseCurrencyName").text("Base Currency Name: "+t),$("#convertedCurrencyCode").text("Country Currency Code: "+o),$("#convertedCurrencyName").text("Country Currency Name: "+r),$("#conversionRate").text("Conversion Rate: "+n),$("#currencyModal").modal("show")},error:function(a){console.log("Error: ",a)}})}function weatherForecast(){let a=$("#selectCountry").val();$.ajax({url:"libs/php/getWeatherForecast.php",type:"POST",dataType:"json",data:{countryCode:a},success:function(a){$("#temp").text(a.data.temp),$("#feels_like").text(a.data.feels_like),$("#temp_min").text(a.data.temp_min),$("#temp_max").text(a.data.temp_max),$("#pressure").text(a.data.pressure),$("#humidity").text(a.data.humidity),$("#main").text(a.data.main),$("#description").text(a.data.description)},error:function(a,e,t){console.log(e,t)}})}function publicHolidays(){let a=$("#selectCountry").val();$.ajax({url:"libs/php/getPublicHolidays.php",type:"GET",dataType:"json",data:{countryCode:a},success:function(a){var e="";for(let t=0;t<a.length;t++)e+='<div class="holiday">',e+='<span class="date">Date: '+a[t].date+"</span>",e+='<span class="name">Name: '+a[t].name+"</span>",e+="</div>";$("#holidayModal .modal-body").html(e)},error:function(a){console.log("Error: ",a)}})}$("#selectCountry").on("change",()=>{let a=$("#selectCountry").val();displayCountryMap(a),displayEarthquakeMarkers(a),displayPlaceOfInterestMarkers(a),populateModal(),$.ajax({url:"libs/php/getCountryBorders.php",type:"GET",dataType:"json",data:{iso:$("#selectCountry").val()},success:function(a){void 0!=countryBorder&&myMap.removeLayer(countryBorder),countryBorder=L.geoJSON(a.data.geometry,{style:()=>({color:"Green",weight:2,opacity:2})}).addTo(myMap),myMap.fitBounds(countryBorder.getBounds())},error:function(a){console.log(a)}})}),$("#selectCountry").on("change",()=>populateModal()),$("#selectCountry").change(publicHolidays);let overlay=L.markerClusterGroup(),earthquake=L.featureGroup.subGroup(overlay),placesOfInterest=L.featureGroup.subGroup(overlay);function displayEarthquakeMarkers(a){earthquake.clearLayers(),$.ajax({url:"libs/php/getCoordinates.php",type:"POST",dataType:"json",data:{countryCord:a},success:function(a){let e=a.data.geonames[0].north,t=a.data.geonames[0].east,o=a.data.geonames[0].south,r=a.data.geonames[0].west;$.ajax({url:"libs/php/getEarthquakeInfo.php",type:"POST",dataType:"json",data:{north:e,south:o,east:t,west:r},success:function(a){if("ok"==a.status.name){let e=a.data;for(let t=0;t<e.length;t++){let o=a.data[t].lat,r=a.data[t].lng,n=a.data[t].magnitude,s=a.data[t].depth;earthquakeIcon=L.ExtraMarkers.icon({icon:"fas fa-globe-americas fa-2x",markerColor:"orange",iconColor:"black",shape:"circle",prefix:"fa"});let c=L.marker([o,r],{icon:earthquakeIcon});c.bindPopup('<div class="popup-header"><b>Earthquake</b></div><div class="popup-coordinates">Coordinates: ('+o.toFixed(4)+", "+r.toFixed(4)+')</div><hr class="m-2"><div class="popup-magnitude">Magnitude: '+n+'</div><div class="popup-depth">Depth: '+s+" km</div>",{className:"custom-popup"}),earthquake.addLayer(c)}}},error:function(a,e,t){console.log("ERROR")}})},error:function(a,e,t){console.log("ERROR")}})}function displayPlaceOfInterestMarkers(a){placesOfInterest.clearLayers(),$.ajax({url:"libs/php/getCoordinates.php",type:"POST",dataType:"json",data:{countryCord:a},success:function(a){let e=a.data.geonames[0].north,t=a.data.geonames[0].east,o=a.data.geonames[0].south,r=a.data.geonames[0].west;$.ajax({url:"libs/php/getPlacesOfInterest.php",type:"POST",dataType:"json",data:{north:e,south:o,east:t,west:r},success:function(a){if("ok"==a.status.name){placesOfInterest.clearLayers();let e,t,o,r,n,s;for(let c=0;c<a.data.length&&(e=a.data[c].lat,t=a.data[c].lng,o=a.data[c].wikipediaUrl,r=a.data[c].title,n=L.ExtraMarkers.icon({icon:"fas fa-map-marker fa-3x",markerColor:"blue",iconColor:"red",shape:"circle",prefix:"fa"}),(s=L.marker([e,t],{icon:n})).bindPopup("<b>"+r+"</b><br>("+e.toFixed(4)+", "+t.toFixed(4)+')<hr class="m-2"><br>'+`<a target="_blank" style="color:black; text-decoration:none;" href="//${o}">More information</a>`,{className:"custom-popup"}),placesOfInterest.addLayer(s),!(c>30));c++);}},error:function(a,e,t){console.log("ERROR")}})},error:function(a,e,t){console.log("ERROR")}})}overlay.addTo(myMap),layerControl.addOverlay(earthquake,"Earthquake"),layerControl.addOverlay(placesOfInterest,"Place of Interest");